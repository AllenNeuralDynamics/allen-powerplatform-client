swagger: '2.0'
info:
  title: PowerAutomate Dataverse API
  description: REST API client to trigger PowerAutomate flows for Dataverse operations
  version: 1.0.0
host: ${DATAVERSE_HOST}
basePath: /
schemes:
  - https
consumes:
  - application/json
produces:
  - application/json

securityDefinitions:
  oauth2-auth:
    type: oauth2
    flow: accessCode
    tokenUrl: https://login.windows.net/${DATAVERSE_TENANT_ID}/oauth2/authorize
    scopes:
      https://service.flow.microsoft.com//.default: https://service.flow.microsoft.com//.default
    authorizationUrl: https://login.microsoftonline.com/${DATAVERSE_TENANT_ID}/oauth2/authorize
  oAuthClientCredentials:
    type: oauth2
    flow: application
    tokenUrl: https://login.windows.net/${DATAVERSE_TENANT_ID}/oauth2/authorize
    scopes:
      https://service.flow.microsoft.com//.default: https://service.flow.microsoft.com//.default
  certOauth:
    type: oauth2
    flow: application
    tokenUrl: https://login.windows.net/${DATAVERSE_TENANT_ID}/oauth2/authorize
    scopes:
      https://service.flow.microsoft.com//.default: https://service.flow.microsoft.com//.default

security:
  - oauth2-auth:
      - https://service.flow.microsoft.com//.default
  - oAuthClientCredentials:
      - https://service.flow.microsoft.com//.default
  - certOauth:
      - https://service.flow.microsoft.com//.default

paths:
  /powerautomate/automations/direct/workflows/{projectWorkflowId}/triggers/manual/paths/invoke:
    post:
      summary: Trigger Get Project Power Automate Flow
      description: Triggers a Power Automate flow that fetches project data by project name
      operationId: FetchProjectByName
      parameters:
        - in: path
          name: projectWorkflowId
          required: true
          type: string
          description: The PowerAutomate workflow ID for project operations
        - name: api-version
          in: query
          required: true
          type: integer
          default: 1
        - name: body
          in: body
          required: true
          schema:
            $ref: '#/definitions/ProjectRequest'
      responses:
        default:
          description: Flow triggered successfully
          schema:
            type: object
            additionalProperties: true

  /powerautomate/automations/direct/workflows/{tableWorkflowId}/triggers/manual/paths/invoke:
    post:
      summary: Trigger Get Table Power Automate Flow
      description: Triggers a Power Automate flow that fetches a full table in Dataverse by the logical table name
      operationId: FetchTableByName
      parameters:
        - in: path
          name: tableWorkflowId
          required: true
          type: string
          description: The PowerAutomate workflow ID for table operations
        - name: api-version
          in: query
          required: true
          type: integer
          default: 1
        - name: body
          in: body
          required: true
          schema:
            $ref: '#/definitions/TableRequest'
      responses:
        default:
          description: Flow triggered successfully
          schema:
            type: object
            additionalProperties: true

  /powerautomate/automations/direct/workflows/{tablesWorkflowId}/triggers/manual/paths/invoke:
    post:
      summary: Trigger GetTableNames Power Automate Flow
      description: Triggers a Power Automate flow that fetches custom table names in Dataverse
      operationId: FetchTableNames
      parameters:
        - in: path
          name: tablesWorkflowId
          required: true
          type: string
          description: The PowerAutomate workflow ID for fetching table names
        - name: api-version
          in: query
          required: true
          type: integer
          default: 1
      responses:
        default:
          description: Flow triggered successfully
          schema:
            type: object
            additionalProperties: true

definitions:
  ProjectRequest:
    type: object
    required:
      - projectName
    properties:
      projectName:
        type: string
        example: CCF Template
        description: The project name in projects table in Dataverse
        title: Project Name
        
  TableRequest:
    type: object
    required:
      - tableName
    properties:
      tableName:
        type: string
        description: The logical name of Dataverse table
        title: Table Name