# allen-dataverse-client

A Python client library for interacting with Dataverse operations through PowerAutomate flows.

## Auto-generated Client Code
- The client is autogenerated using an openapi generator.
- The client can be pip installed as `pip install aind-dataverse-client`

## Contributing

This package is generated from PowerAutomate flows and OpenAPI specifications. The overall architecture is: 

```
Dataverse → PowerAutomate Flows → OpenAPI Spec → Generated Python Client
```

To contribute: 
### 1. Update/Create PowerAutomate Flows

- Navigate to PowerAutomate and locate the relevant flow
- Make necessary changes to the flow logic, inputs, or outputs in PowerAutomate editor. 
- Test the flow to ensure it works as expected.
- Note any changes to input/output schemas

### 2. Update OpenAPI Specification

- Edit `openapi.yaml` to reflect changes made to the PowerAutomate flows. This can be done directly or via the PowerAutomate Custom Connector UI. More on this below.
- Update paths, parameters, request/response schemas as needed
- Use environment variable placeholders instead of path values:
  - `${DATAVERSE_HOST}` for the host
  - `${DATAVERSE_WORKFLOW_*_PATH}` for workflow endpoints
  - `${DATAVERSE_API_VERSION}`, `${DATAVERSE_SP}`, `${DATAVERSE_SV}` for query parameters

- Note: The `openapi.yaml` can be updated through PowerAutomate UI by updating the "allen-dataverse-client" custom connector. This is useful for testing. Remember to copy changes into this repository and ensure all secret values are replaced with environement variables. 

### 3. Regenerate the Client

The client can be re-generated using the docker image: 

```bash
docker run --rm \
  -v ${PWD}:/local \
  openapitools/openapi-generator-cli generate \
  -i /local/openapi.yaml \
  -g python \
  -o /local/allen-dataverse-client \
  --skip-validate-spec \
  --additional-properties packageName=allen_dataverse_client,projectName=allen-dataverse-client
```

On Windows PowerShell:
```powershell
docker run --rm -v ${PWD}:/local openapitools/openapi-generator-cli generate -i /local/openapi.yaml -g python -o /local/allen-dataverse-client --skip-validate-spec --additional-properties packageName=allen_dataverse_client,projectName=allen-dataverse-client
```

Note: the `skip-validate-spec` flag is used to allow env variable placeholders in the OpenAPI spec.


### 4. Test Changes

- Install the updated client: `pip install -e .`
- Run integration tests to verify functionality. Recommended to test via Custom connectors and python client. 
